{% extends 'blog/base.html' %}

{% block titulo %}Blog - Santino Rodriguez{% endblock %}

{% block contenido %}
    <section class="Blog">
        <div class="BlogHeader">
            <h1>Blog Personal</h1>
            <p>Pensamientos, ideas y experiencias sobre desarrollo, tecnología y más.</p>
        </div>

        <div class="FiltrosPost">
            <button class="FiltroPost activo">Todos</button>
            <button class="FiltroPost">Recientes</button>
            <button class="FiltroPost">Populares</button>
            <button class="FiltroPost">Trending</button>
            <button class="FiltroPost">Programación</button>
        </div>

        {% for post in posts %}
        <article class="Post">
            <div class="PostHeader">
                <div class="PerfilUsuario">
                    <div class="AvatarUsuario" style="background: linear-gradient(135deg, #4dabf7 0%, #1c7ed6 100%);">
                        {{ post.author.first_name|first|default:"S"|upper }}
                    </div>
                    <div class="DetallesUsuario">
                        <div class="NombreUsuario">{{ post.author.get_full_name|default:"Santino Rodriguez" }}</div>
                        <div class="TiempoPublicacion">{{ post.published_date|timesince }} • 
                            {% if post.is_featured %}
                                Destacado
                            {% elif post.is_trending %}
                                Trending
                            {% else %}
                                Post
                            {% endif %}
                        </div>
                    </div>
                    <div class="EstadoBadge">
                        {% if post.is_sponsored %}
                            <span class="Badge patrocinado">Patrocinado</span>
                        {% elif post.is_new %}
                            <span class="Badge nuevo">Nuevo</span>
                        {% elif post.is_trending %}
                            <span class="Badge trending">Trending</span>
                        {% elif post.category == 'tutorial' %}
                            <span class="Badge tutorial">Tutorial</span>
                        {% elif post.category == 'ai' %}
                            <span class="Badge ai">AI/ML</span>
                        {% elif post.category == 'css' %}
                            <span class="Badge css">CSS</span>
                        {% elif post.category == 'performance' %}
                            <span class="Badge performance">Performance</span>
                        {% elif post.category == 'rust' %}
                            <span class="Badge rust">Rust</span>
                        {% elif post.category == 'graphql' %}
                            <span class="Badge graphql">GraphQL</span>
                        {% elif post.category == 'comparison' %}
                            <span class="Badge comparison">Comparación</span>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Contenido del post (ESTA PARTE FALTABA) -->
            <div class="PostContenido">
                <h2 class="TituloPost">
                    <a href="{% url 'blog:post_detail' pk=post.pk %}" style="text-decoration: none; color: inherit;">
                        {{ post.title }}
                    </a>
                </h2>
                
                {% if post.image %}
                <div class="PostImagen">
                    <img src="{{ post.image.url }}" 
                         alt="{{ post.title }}" 
                         class="ImagenPrincipal"
                         style="height: 200px; cursor: pointer;"
                         onclick="window.location.href='{% url 'blog:post_detail' pk=post.pk %}'">
                    {% if post.external_link %}
                    <a href="{{ post.external_link }}" class="EnlaceExterno" target="_blank">
                        {{ post.external_link|truncatechars:25 }}
                    </a>
                    {% endif %}
                </div>
                {% endif %}
                
                <div class="ContenidoPost">
                    <!-- Resumen del contenido (primeros 200 caracteres) -->
                    {{ post.text|truncatewords:30|linebreaksbr }}
                    {% if post.text|length > 200 %}
                        <div class="LeerMas">
                            <a href="{% url 'blog:post_detail' pk=post.pk %}" 
                               style="color: var(--acento-medio); text-decoration: none; font-weight: 500;">
                                Leer más →
                            </a>
                        </div>
                    {% endif %}
                </div>

                <!-- Tags del post -->
                {% if post.tags.all %}
                <div class="TagsPost">
                    {% for tag in post.tags.all %}
                    <span class="Tag">{{ tag.name }}</span>
                    {% endfor %}
                </div>
                {% endif %}
            </div>

            <div class="PostFooter">
                <div class="AccionesPost">
                    <div class="BotonesAccion">
                        <button class="BotonAccion like {% if post.is_liked %}activo{% endif %}" data-post-id="{{ post.pk }}">
                            <svg class="IconoAccion" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                            </svg>
                            <span>{{ post.likes|default:0 }}</span>
                        </button>
                        <button class="BotonAccion" onclick="window.location.href='{% url 'blog:post_detail' pk=post.pk %}#comments'">
                            <svg class="IconoAccion" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                            </svg>
                            <span>{{ post.comments_count|default:0 }}</span>
                        </button>
                        <button class="BotonAccion bookmark {% if post.is_bookmarked %}activo{% endif %}" data-post-id="{{ post.pk }}">
                            <svg class="IconoAccion" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2z"/>
                            </svg>
                        </button>
                        <button class="BotonAccion" onclick="window.location.href='{% url 'blog:post_detail' pk=post.pk %}'">
                            <svg class="IconoAccion" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M9 5l7 7-7 7"/>
                            </svg>
                        </button>
                    </div>
                    <div class="EstadisticasPost">
                        <span>{{ post.views|default:0 }} views</span>
                        <span>•</span>
                        <span>{{ post.upvote_percentage|default:95 }}% upvoted</span>
                        <span>•</span>
                        <span>{{ post.text|wordcount }} palabras</span>
                    </div>
                </div>
            </div>
        </article>
        {% empty %}
        <!-- Mensaje si no hay posts -->
        <div class="Post">
            <div class="PostContenido">
                <h2 class="TituloPost">No hay posts disponibles</h2>
                <p class="ContenidoPost">Aún no se han publicado posts en este blog. ¡Vuelve pronto para ver el nuevo contenido!</p>
            </div>
        </div>
        {% endfor %}

        <!-- Loading skeleton (oculto por defecto) -->
        <div class="PostSkeleton" style="display: none;" id="loadingSkeleton">
            <div class="SkeletonLine titulo"></div>
            <div class="SkeletonLine contenido"></div>
            <div class="SkeletonLine contenido"></div>
            <div class="SkeletonLine meta"></div>
        </div>
    </section>
{% endblock %}
{% extends 'blog/base.html' %}
{% load static %}

{% block titulo %}
    {% if post %}
        Editar Post - {{ post.title }}
    {% else %}
        Crear Nuevo Post
    {% endif %} 
    - Blog Santino Rodriguez
{% endblock %}

{% block contenido %}
<section class="EditorPost">
    <!-- Header del Editor -->
    <div class="EditorHeader">
        <div class="HeaderInfo">
            <div class="TituloEditor">
                <svg class="IconoEditor" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                </svg>
                <span id="tituloEditor">Editando Post</span>
            </div>
            <div class="SubtituloEditor" id="subtituloEditor">
                Modificando: "{{ post.title|truncatechars:60 }}"
            </div>
        </div>
        
        <div class="EstadoEditor">
            <span class="BadgeEstado {% if post.published_date %}publicado{% else %}borrador{% endif %}" id="badgeEstado">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    {% if post.published_date %}
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                        <polyline points="22,4 12,14.01 9,11.01"/>
                    {% else %}
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14,2 14,8 20,8"/>
                        <line x1="16" y1="13" x2="8" y2="13"/>
                        <line x1="16" y1="17" x2="8" y2="17"/>
                    {% endif %}
                </svg>
                {% if post.published_date %}Publicado{% else %}Borrador{% endif %}
            </span>
            <div class="InfoModificacion" id="infoModificacion">
                {% if post.published_date %}
                    Publicado: {{ post.published_date|date:"d M Y" }}
                {% else %}
                    Creado: {{ post.created_date|date:"d M Y" }}
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Vista del post original -->
    <div class="VistaOriginal" id="vistaOriginal">
        <div class="VistaOriginalHeader">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                <circle cx="12" cy="12" r="3"/>
            </svg>
            {% if post.published_date %}Versi√≥n actual publicada{% else %}Borrador actual{% endif %}
        </div>
        <div class="PostOriginal">
            <h3 class="PostOriginalTitulo">{{ post.title }}</h3>
            <div class="PostOriginalContenido">
                {{ post.text|linebreaksbr|truncatewords:30 }}
                {% if post.text|wordcount > 30 %}
                    <span class="VerMas">... [{{ post.text|wordcount }} palabras total]</span>
                {% endif %}
            </div>
            {% if post.image %}
                <img class="PostOriginalImagen" src="{{ post.image.url }}" alt="{{ post.title }}">
            {% endif %}
            <div class="PostOriginalMeta">
                {% if post.published_date %}
                    <span>üìÖ Publicado: {{ post.published_date|date:"d M Y" }}</span>
                {% else %}
                    <span>üìÖ Creado: {{ post.created_date|date:"d M Y" }}</span>
                {% endif %}
                <span>üëÅÔ∏è {{ post.views|default:0 }} vistas</span>
                <span>üí¨ {{ post.comments.count }} comentarios</span>
                {% if post.tags.all %}
                    <span>üè∑Ô∏è {% for tag in post.tags.all %}{{ tag.name }}{% if not forloop.last %}, {% endif %}{% endfor %}</span>
                {% endif %}
                {% if post.category %}
                    <span>üìÇ {{ post.get_category_display }}</span>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Formulario Principal -->
    <form method="POST" enctype="multipart/form-data" class="FormularioEditor" id="formEditor">
        {% csrf_token %}
        
        <!-- Campo T√≠tulo -->
        <div class="ContenidoPrincipal">
            <div class="CampoEditor titulo-campo">
                <label for="id_title" class="LabelEditor">
                    <svg class="IconoLabel" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M4 7V4a1 1 0 0 1 1-1h2M4 7v2M4 7h3m13 4V4a1 1 0 0 0-1-1h-2m3 7v2m0-2h-3"/>
                        <path d="M11 7h2v10"/>
                        <path d="M8 17l8 0"/>
                    </svg>
                    T√≠tulo del Post
                </label>
                <input type="text" name="title" id="id_title" class="InputEditor titulo-input" placeholder="Escribe un t√≠tulo llamativo para tu post..." value="{{ post.title }}"maxlength="200"required>
                <div class="AyudaCampo">
                    <div class="ContadorCaracteres" id="contadorTitulo">{{ post.title|length }}/200</div>
                </div>
            </div>

            <!-- Campo Contenido -->
            <div class="CampoEditor contenido-campo">
                <label for="id_text" class="LabelEditor">
                    <svg class="IconoLabel" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14,2 14,8 20,8"/>
                        <line x1="16" y1="13" x2="8" y2="13"/>
                        <line x1="16" y1="17" x2="8" y2="17"/>
                        <line x1="10" y1="9" x2="8" y2="9"/>
                    </svg>
                    Contenido del Post
                </label>
                <div class="EditorContenido">
                    <textarea name="text" id="id_text" class="TextareaEditor"placeholder="Comparte tus ideas, experiencias y conocimientos..." rows="15"required>{{ post.text }}</textarea>
                    <div class="BarraHerramientas">
                        <div class="GrupoHerramientas">
                            <button type="button" class="BotonHerramienta" onclick="aplicarFormato('bold')" title="Negrita">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M6 4h8a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"/>
                                    <path d="M6 12h9a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"/>
                                </svg>
                            </button>
                            <button type="button" class="BotonHerramienta" onclick="aplicarFormato('italic')" title="Cursiva">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <line x1="19" y1="4" x2="10" y2="4"/>
                                    <line x1="14" y1="20" x2="5" y2="20"/>
                                    <line x1="15" y1="4" x2="9" y2="20"/>
                                </svg>
                            </button>
                            <button type="button" class="BotonHerramienta" onclick="aplicarFormato('code')" title="C√≥digo">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="16,18 22,12 16,6"/>
                                    <polyline points="8,6 2,12 8,18"/>
                                </svg>
                            </button>
                        </div>
                        <div class="ContadorPalabras" id="contadorPalabras">{{ post.text|wordcount }} palabras</div>
                    </div>
                </div>
            </div>

            <!-- Vista previa actualizada en tiempo real -->
            <div class="PanelSeccion">
                <h3 class="TituloPanelSeccion">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                        <circle cx="12" cy="12" r="3"/>
                    </svg>
                    Vista previa (Sin Imagenes)
                </h3>
                <div class="VistaPrevia" id="vistaPrevia">
                    <div class="PreviewTitulo">{{ post.title }}</div>
                    <div class="PreviewContenido">{{ post.text|linebreaksbr }}</div>
                </div>
            </div>
        </div>

        <!-- Panel Lateral -->
        <div class="PanelLateral">
            <!-- Configuraci√≥n de Publicaci√≥n -->
            <div class="PanelSeccion">
                <h3 class="TituloPanelSeccion">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                    </svg>
                    Configuraci√≥n
                </h3>
                
                <!-- Imagen destacada -->
                <div class="CampoPanel">
                    <label for="id_image" class="LabelPanel">Imagen destacada</label>
                    <div class="SubidaImagen" id="subirImagen">
                        <input type="file" name="image" id="id_image" accept="image/*" style="display: none;">
                        <div class="AreaSubida {% if post.image %}con-imagen{% endif %}" onclick="document.getElementById('id_image').click()">
                            {% if post.image %}
                                <img id="preview" src="{{ post.image.url }}" alt="{{ post.title }}" class="ImagenPreview">
                                <div class="OverlayImagen">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                        <polyline points="14,2 14,8 20,8"/>
                                        <line x1="12" y1="18" x2="12" y2="12"/>
                                        <line x1="9" y1="15" x2="12" y2="12"/>
                                        <line x1="15" y1="15" x2="12" y2="12"/>
                                    </svg>
                                    <span>Cambiar imagen</span>
                                </div>
                            {% else %}
                                <div class="PlaceholderImagen">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                        <circle cx="8.5" cy="8.5" r="1.5"/>
                                        <polyline points="21,15 16,10 5,21"/>
                                    </svg>
                                    <span>Agregar imagen</span>
                                    <small>JPG, PNG hasta 5MB</small>
                                </div>
                            {% endif %}
                        </div>
                        {% if post.image %}
                            <div class="InfoImagen">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="3"/>
                                    <path d="M12 1v6m0 6v6"/>
                                </svg>
                                Imagen actual: {{ post.image.name }}
                            </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Categor√≠a -->
                <div class="CampoPanel">
                    <label for="id_category" class="LabelPanel">Categor√≠a</label>
                    <div class="SelectWrapper">
                        <select name="category" id="id_category" class="SelectEditor">
                            <option value="">Seleccionar categor√≠a</option>
                            <option value="tutorial" {% if post.category == 'tutorial' %}selected{% endif %}>Tutorial</option>
                            <option value="programming" {% if post.category == 'programming' %}selected{% endif %}>Programaci√≥n</option>
                            <option value="design" {% if post.category == 'design' %}selected{% endif %}>Dise√±o</option>
                            <option value="technology" {% if post.category == 'technology' %}selected{% endif %}>Tecnolog√≠a</option>
                            <option value="ai" {% if post.category == 'ai' %}selected{% endif %}>AI/ML</option>
                            <option value="css" {% if post.category == 'css' %}selected{% endif %}>CSS</option>
                            <option value="performance" {% if post.category == 'performance' %}selected{% endif %}>Performance</option>
                            <option value="rust" {% if post.category == 'rust' %}selected{% endif %}>Rust</option>
                            <option value="graphql" {% if post.category == 'graphql' %}selected{% endif %}>GraphQL</option>
                            <option value="comparison" {% if post.category == 'comparison' %}selected{% endif %}>Comparaci√≥n</option>
                        </select>
                        <svg class="IconoSelect" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6,9 12,15 18,9"/>
                        </svg>
                    </div>
                </div>

                <!-- Tags -->
                <div class="CampoPanel">
                    <label for="tagsInput" class="LabelPanel">Tags</label>
                    <div class="TagsInput">
                        <div class="TagsContainer" id="tagsContainer">
                            {% for tag in post.tags.all %}
                                <span class="TagItem">
                                    {{ tag.name }}
                                    <button type="button" onclick="eliminarTag(this)" class="EliminarTag">√ó</button>
                                </span>
                            {% endfor %}
                        </div>
                        <input type="text" id="tagsInput" placeholder="Agregar tags..."onkeypress="agregarTag(event)"class="InputTags">
                    </div>
                    <div class="TextoAyuda">Presiona Enter para agregar un tag</div>
                </div>

                <!-- Enlace externo -->
                <div class="CampoPanel">
                    <label for="id_external_link" class="LabelPanel">Enlace externo</label>
                    <input type="url" name="external_link" id="id_external_link" class="InputPanel"placeholder="https://ejemplo.com"value="{{ post.external_link|default:'' }}">
                    <div class="TextoAyuda">Enlace relacionado al contenido</div>
                </div>
            </div>

            <!-- Opciones adicionales -->
            <div class="PanelSeccion">
                <h3 class="TituloPanelSeccion">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9,11 12,14 22,4"/>
                        <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
                    </svg>
                    Opciones
                </h3>
                
                <div class="OpcionesList">
                    <label class="OpcionCheck">
                        <input type="checkbox" name="is_featured" {% if post.is_featured %}checked{% endif %}>
                        <span class="Checkmark"></span>
                        <span class="LabelCheck">Post destacado</span>
                    </label>
                    
                    <label class="OpcionCheck">
                        <input type="checkbox" name="is_trending" {% if post.is_trending %}checked{% endif %}>
                        <span class="Checkmark"></span>
                        <span class="LabelCheck">Marcar como trending</span>
                    </label>
                    
                    <label class="OpcionCheck">
                        <input type="checkbox" name="allow_comments" {% if post.allow_comments %}checked{% endif %}>
                        <span class="Checkmark"></span>
                        <span class="LabelCheck">Permitir comentarios</span>
                    </label>
                </div>
            </div>

            <!-- Estad√≠sticas del post -->
            <div class="PanelSeccion">
                <h3 class="TituloPanelSeccion">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 3v18h18"/>
                        <path d="M18.7 8l-5.1 5.2-2.8-2.7L7 14.3"/>
                    </svg>
                    Estad√≠sticas
                </h3>
                <div class="EstadisticasPost">
                    <div class="EstadisticaItem">
                        <span class="EstadisticaValor">{{ post.views|default:0 }}</span>
                        <span class="EstadisticaLabel">Vistas</span>
                    </div>
                    <div class="EstadisticaItem">
                        <span class="EstadisticaValor">{{ post.comments.count }}</span>
                        <span class="EstadisticaLabel">Comentarios</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Botones de acci√≥n -->
        <div class="AccionesFormulario">
            <div class="GrupoAcciones principal">
                {% if not post.published_date %}
                    <button type="submit" name="action" value="publish" class="BotonSecundario">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 19l7-7 3 3-7 7-3-3z"/>
                            <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/>
                            <path d="M2 2l7.5 3.5L18 13"/>
                        </svg>
                        Publicar post
                    </button>
                {% else %}
                    <button type="submit" name="action" value="publish" class="BotonSecundario">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 19l7-7 3 3-7 7-3-3z"/>
                            <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/>
                            <path d="M2 2l7.5 3.5L18 13"/>
                        </svg>
                        Actualizar publicaci√≥n
                    </button>
                {% endif %}
            </div>
            
            <div class="GrupoAcciones secundario">
                {% if post %}
                    <a href="{% url 'blog:post_detail' pk=post.pk %}" class="BotonTerciario">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                            <circle cx="12" cy="12" r="3"/>
                        </svg>
                        Ver post
                    </a>

                    <button type="button" class="BotonEliminar" onclick="confirmarEliminacion()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="3,6 5,6 21,6"/>
                            <path d="M14,6V4a2,2 0 0,0-2-2H8a2,2 0 0,0-2,2V6"/>
                            <path d="M19,6v14a2,2 0 0,1-2,2H7a2,2 0 0,1-2-2V6"/>
                            <line x1="10" y1="11" x2="10" y2="17"/>
                            <line x1="14" y1="11" x2="14" y2="17"/>
                        </svg>
                        Eliminar
                    </button>
                {% endif %}
            </div>
        </div>
    </form>
</section>

{% endblock %}